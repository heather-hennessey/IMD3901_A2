<!DOCTYPE html>
<html>
        <head>
                <meta charset="utf-8">
                <title>Hello, WebVR! • A-Frame</title>
                <meta name="description" content="Hello, WebVR! • A-Frame">
                <script src="https://aframe.io/releases/0.8.2/aframe.min.js"></script>
                <script src="https://rawgit.com/Ctrl-Alt-Zen/aframe-mobile-controls/master/components/tilt-turn/tilt-turn.js"></script>         <!--Tilt-turn-->
                <script src="https://cdn.rawgit.com/donmccurdy/aframe-physics-system/v3.3.0/dist/aframe-physics-system.min.js"></script>        <!--Physics-->
                <script src="https://unpkg.com/aframe-particle-system-component@1.0.x/dist/aframe-particle-system-component.min.js"></script>   <!--Particles-->
                <script src="https://rawgit.com/rdub80/aframe-shake2show-component/master/dist/aframe-shake2show-component.min.js"></script>    <!--Shake-->
                <script src="https://cdn.rawgit.com/donmccurdy/aframe-extras/v4.1.2/dist/aframe-extras.min.js"></script>
                <script src="https://unpkg.com/super-hands@3.0.0/dist/super-hands.min.js"></script>                                             <!--Super Hands-->
                <script>
                   
                   // ******************* COMPONENTS *********************** // 
                    
                   AFRAME.registerComponent('interactable', {
                        schema: {
                        },

                        init: function()
                        {
                            this.onGrabStart = this.onGrabStart.bind(this);
                            this.onGrabEnd = this.onGrabEnd.bind(this);
                            this.onHoverStart = this.onHoverStart.bind(this);
                            this.onHoverEnd = this.onHoverEnd.bind(this);
                            this.followMouse = this.followMouse.bind(this);
                        },
                        update: function()
                        {
                            var el = this.el;

                            el.addEventListener('grab-start', this.onGrabStart);
                            el.addEventListener('grab-end', this.onGrabEnd);

                            el.addEventListener('hover-start', this.onHoverStart);
                            el.addEventListener('hover-end', this.onHoverEnd);

                            
                        },
                        onGrabStart: function(evt)
                        {
                            this.el.sceneEl.canvas.addEventListener( 'mousemove', this.followMouse);
                        },
                        onGrabEnd: function(evt)
                        {
                            this.el.sceneEl.canvas.removeEventListener('mousemove', this.followMouse);

                            // console.log(this.el);
                            // this.el.object3D.position.set(this.el.position.x, this.el.position.y, this.el.position.z); 
                        },
                        onHoverStart: function(evt)
                        {
                            this.el.setAttribute('material', {opacity: 0.7, transparent: true});
                        },
                        onHoverEnd: function(evt)
                        {
                            this.el.setAttribute('material', {opacity: 1, transparent: false});
                        },
                        followMouse: function(evt)
                        {
                            var mouse = new THREE.Vector2();
                            var rect = evt.target.getBoundingClientRect();
                            mouse.x = ( (evt.clientX - rect.left) / rect.width ) * 2 - 1;
                            mouse.y = - ( (evt.clientY - rect.top) / rect.height ) * 2 + 1;
                            let vector = new THREE.Vector3( mouse.x, mouse.y, - 1);
                            //console.log(vector);
                            this.el.object3D.position.set(vector.x, vector.y, vector.z);
                        }
                    });
                        
                    
                   AFRAME.registerComponent('loadscripts', {
                        init: function()
                        {
                            // Add scripts to the 'scriptSrc' list below so they are loaded after the scene is created
                            scriptSrc = ["interactions.js"]
                            var head= document.getElementsByTagName('head')[0];
                            for (var i = 0; i < scriptSrc.length; i++) {
                                newScript = document.createElement('script');
                                newScript.setAttribute('src', scriptSrc[i]);
                                head.appendChild(newScript);
                            }
                        }
                    });
                    
                </script>
              </head>
              
              <body>
                
                <a-scene loadscripts>
                <!---------------------------------    MIXIN (Interactable Object)    -------------------------------------->
                <a-assets>
                <a-mixin id="can" geometry="primitive: cylinder; radius: 0.08; height: 0.3;"
                        hoverable grabbable draggable droppable interactable shadow>
                </a-mixin>
                </a-assets>
                <!---------------------------------    ENVIRONMENT     -------------------------------------->
                <a-plane position="0 0 5" width="30" height="30" rotation="-90 0 0" color="#a5a5a5" shadow></a-plane>
            
                <a-sky color="#ECECEC"></a-sky>
                <a-entity   id="sky"
                        geometry="primitive: sphere; radius: 1000"
                        material="shader: flat; color: grey; side: back">
                </a-entity>                

                <!---------------------------------    CAMERA     -------------------------------------->
                <a-entity id="camRig" position="0 1.4 0" wasd-controls>
                    <a-entity id="cam" camera 
                        capture-mouse
                        raycaster="objects: [interactable]" 
                        static-body="shape: sphere; sphereRadius: 0.001"
                        super-hands="colliderEvent: raycaster-intersection;
                                    colliderEventProperty: els;
                                    colliderEndEvent:raycaster-intersection-cleared;
                                    colliderEndEventProperty: clearedEls;">
                        <a-entity id="sceneCursor" cursor="rayOrigin: mouse; fuseTimeout: 500"></a-entity>                    
                    </a-entity>
                    <a-entity id="bCan" mixin="can" position="1 -1 -1.25" material="color: blue"></a-entity>
                    <a-entity id="rCan" mixin="can" position="0 -1 -1.25" material="color: red"></a-entity>
                    <a-entity id="gCan" mixin="can" position="-1 -1 -1.25" material="color: green"></a-entity>
                </a-entity>
                  

                <!---------------------------------    LIGHTS     -------------------------------------->
                  <a-entity light="type: ambient; intensity: 1.0; color:#fff;"></a-entity>
                  <a-entity light="type: directional; castShadow:true; intensity:0.6; shadowBias:-0.000001; shadowMapWidth:1024; shadowMapHeight:1024;" position="-0.5 1 1" ></a-entity>
                  

                <!---------------------------------    OBJECTS     -------------------------------------->
                
                <a-entity id="wall" geometry="primitive:plane;height:4;width:10" position="0 1.16842 -2.61869" material="color:#572015;"></a-entity>                
                <a-entity id="garbageCan" geometry="primitive:cylinder;radius:0.2;height:0.5" position="3 0.24216 -2.31734" material="color:#3a3a48;"></a-entity>
                <a-entity id="spray" position="0 0.4 -1.8" 
                            particle-system="color:#EF0000, #EF0000;
                                            size:.08;
                                            accelerationValue:1 1 1;
                                            maxAge:.3;
                                            rotationAxis: x;
                                            rotationAngle: 1.5"></a-entity>     
                </a-scene>
              </body>           
</html>